<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Interactive Monthly Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --bg-color:#F5F5F5;
            --text-color:#333333;
            --card-bg:#FFFFFF;
            --accent-color:#E42642;
            --completed-color:#B5B5B5;
            --overdue-color:#E42642;
            --progress-bg:#e5e7eb;
            --progress-fill:#10b981;
        }
        body{font-family:'Inter',sans-serif;background-color:var(--bg-color);color:var(--text-color)}
        .nav-btn{transition:all .3s ease}
        .nav-btn.active{background-color:var(--accent-color);color:#fff;font-weight:600}
        .task-card ul{list-style:none;padding:0;margin:0}
        .task-card ul li{display:flex;align-items:center;margin-bottom:.5rem;cursor:grab}
        .task-card ul li:active{cursor:grabbing}
        .completed{text-decoration:line-through;color:var(--completed-color)}
        .sortable-header{cursor:pointer;user-select:none}
        .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.5);align-items:center;justify-content:center}
        .modal-content{background-color:var(--card-bg);padding:24px;border-radius:.75rem;box-shadow:0 4px 6px rgba(0,0,0,.1);max-width:680px;width:94%}
        .close-btn{color:#aaa;float:right;font-size:28px;font-weight:bold}
        .close-btn:hover,.close-btn:focus{color:var(--text-color);text-decoration:none;cursor:pointer}
        .overdue{color:var(--overdue-color);font-weight:bold}
        .progress-bar{background-color:var(--progress-bg);height:8px;border-radius:9999px;overflow:hidden}
        .progress-fill{background-color:var(--progress-fill);height:100%;transition:width .3s ease}
        .error-message{color:#E42642;font-size:.875rem;margin-top:.25rem}
        [role="tab"]:focus{outline:2px solid var(--accent-color)}
        /* card header & edit button */
        .card-header{display:flex;align-items:center;justify-content:space-between;gap:8px}
        .edit-tasks-btn{background:transparent;border:1px solid rgba(0,0,0,.08);padding:6px 10px;border-radius:8px;font-size:.875rem;cursor:pointer}
        .edit-tasks-btn:hover{background:rgba(0,0,0,.03)}
        .task-edit-list{max-height:320px;overflow:auto;margin-bottom:12px}
        .task-edit-item{display:flex;gap:8px;align-items:center;margin-bottom:8px}
        .music-btn{background:var(--accent-color);color:#fff;padding:.5rem .75rem;border-radius:.6rem;font-weight:600;display:inline-flex;align-items:center;gap:.5rem;border:none;cursor:pointer}
        .music-btn:hover{opacity:.95}
        .music-top-right{position:absolute;right:0;top:0}
        header.relative{position:relative}
        /* music modal specific */
        .genre-row{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px;border-radius:8px}
        .genre-actions button{margin-left:6px}
        .small-muted{font-size:.875rem;color:#6b7280}
        /* responsive small tune */
        @media (max-width:640px){
            .music-top-right{position:static;margin-top:.5rem}
        }
    </style>
</head>
<body class="antialiased text-gray-900">
    <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-7xl">
        <header class="text-center mb-8 relative">
            <h1 class="text-4xl font-bold text-gray-800">Monthly Work Planner</h1>
            <p class="text-lg text-gray-600 mt-2 w-full">A dynamic and interactive schedule to keep you organized.</p>

            <div class="music-top-right absolute right-0 top-0">
                <button id="musicBtn" class="music-btn mr-2" title="Open Music genres">üéµ Music</button>
            </div>
        </header>

        <main>
            <nav id="month-navigation" class="flex justify-center items-center bg-white rounded-xl shadow-sm p-2 mb-4">
                <button id="prev-month" class="nav-btn px-4 py-2 text-gray-700">&lt; Prev</button>
                <span id="current-month" class="px-4 py-2 font-semibold"></span>
                <button id="next-month" class="nav-btn px-4 py-2 text-gray-700">Next &gt;</button>
            </nav>

            <nav id="week-navigation" role="tablist" class="flex justify-center items-center bg-white rounded-xl shadow-sm p-2 mb-8"></nav>

            <div id="monthly-progress" class="mb-8 bg-white p-6 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Monthly Progress</h2>
                <div class="progress-bar mb-2"><div id="monthly-progress-fill" class="progress-fill" style="width:0%"></div></div>
                <p id="monthly-progress-text" class="text-sm text-gray-600 text-center">0% Complete</p>
            </div>

            <div id="planner-content"></div>

            <section id="deadlines-section" class="mt-10 bg-white p-6 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-gray-200 pb-2">Upcoming Deadlines</h2>
                <p class="text-gray-600 mb-6">Use this section to track specific deadlines for projects and tasks. Add new deadlines using the form below.</p>
                <ul id="deadline-list" class="space-y-3 mb-8"></ul>
                <div class="mt-6">
                    <h3 class="text-xl font-semibold text-gray-800 mb-3">Add a New Deadline</h3>
                    <form id="add-deadline-form" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                        <div class="md:col-span-1">
                            <label for="deadline-date" class="block text-sm font-medium text-gray-700">Date</label>
                            <input id="deadline-date" type="date" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
                            <p id="deadline-date-error" class="error-message hidden">Please select a date.</p>
                        </div>
                        <div class="md:col-span-2">
                            <label for="deadline-task" class="block text-sm font-medium text-gray-700">Project/Task Name</label>
                            <input id="deadline-task" type="text" placeholder="e.g., Finalize Q3 Report" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
                            <p id="deadline-task-error" class="error-message hidden">Please enter a task name.</p>
                        </div>
                        <div class="md:col-span-1">
                            <label for="deadline-client" class="block text-sm font-medium text-gray-700">Client</label>
                            <input id="deadline-client" type="text" placeholder="e.g., Client Inc." required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
                            <p id="deadline-client-error" class="error-message hidden">Please enter a client.</p>
                        </div>
                        <button type="submit" class="w-full md:w-auto md:col-start-4 bg-[#E42642] text-white font-semibold py-2 px-6 rounded-lg hover:bg-opacity-90 transition-colors">Add Deadline</button>
                    </form>
                </div>
            </section>

            <section id="clients-section" class="mt-10 bg-white p-6 rounded-xl shadow-sm">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-gray-200 pb-2">Active Clients</h2>
                <div class="flex justify-between items-center mb-4">
                    <div class="flex items-center gap-2">
                        <label for="filter-clients" class="text-sm font-medium text-gray-700">Filter by:</label>
                        <select id="filter-clients" class="bg-white text-gray-900 rounded-md border-gray-300 shadow-sm p-2 text-sm">
                            <option value="all">All</option>
                            <option value="incomplete">Incomplete</option>
                            <option value="complete">Complete</option>
                        </select>
                    </div>
                    <div class="flex justify-end gap-2">
                        <button id="undo-client-btn" class="bg-gray-200 text-gray-600 font-semibold py-2 px-6 rounded-lg hidden">Undo Remove</button>
                        <button id="add-client-btn" class="bg-[#E42642] text-white font-semibold py-2 px-6 rounded-lg">Add New Client</button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead>
                            <tr>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider sortable-header" data-sort-key="company">Company</th>
                                <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider sortable-header" data-sort-key="services">Services</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider">Complete</th>
                                <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="client-table-body" class="bg-white divide-y divide-gray-200"></tbody>
                    </table>
                </div>
            </section>
        </main>
    </div>

    <div id="welcome-modal" class="modal" style="display:flex;">
        <div class="modal-content text-center p-8">
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Welcome back, Great Conqueror.</h2>
            <div id="daily-quote-container" class="text-lg text-gray-600 italic mt-4 mb-6">
                </div>
            <button id="close-welcome-modal" class="bg-[#E42642] text-white font-semibold py-2 px-8 rounded-lg hover:bg-opacity-90 transition-colors">Let's Go!</button>
        </div>
    </div>

    <div id="add-client-modal" class="modal">
        <div class="modal-content p-6 rounded-xl shadow-lg">
            <span id="close-modal-btn" class="close-btn">&times;</span>
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Add New Client</h3>
            <form id="new-client-form" class="space-y-4">
                <div>
                    <label for="new-client-company" class="block text-sm font-medium text-gray-700">Company</label>
                    <input id="new-client-company" type="text" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
                    <p id="new-client-company-error" class="error-message hidden">Please enter a company name.</p>
                </div>
                <div>
                    <label for="new-client-services" class="block text-sm font-medium text-gray-700">Services</label>
                    <input id="new-client-services" type="text" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
                    <p id="new-client-services-error" class="error-message hidden">Please enter services.</p>
                </div>
                <div class="flex justify-end gap-2 mt-4">
                    <button id="cancel-new-client-btn" type="button" class="bg-gray-200 text-gray-800 font-semibold py-2 px-6 rounded-lg">Cancel</button>
                    <button id="confirm-new-client-btn" type="submit" class="bg-[#E42642] text-white font-semibold py-2 px-6 rounded-lg">Confirm</button>
                </div>
            </form>
        </div>
    </div>

    <div id="task-edit-modal" class="modal">
        <div class="modal-content">
            <span id="task-edit-close" class="close-btn">&times;</span>
            <h3 id="task-edit-title" class="text-xl font-semibold mb-3">Edit Tasks</h3>
            <div id="task-edit-list" class="task-edit-list mb-3"></div>

            <div class="flex gap-2 items-center mb-3">
                <input id="new-task-text" type="text" placeholder="New task description" class="w-full rounded-md border-gray-300 p-2">
                <select id="new-task-priority" class="rounded-md border-gray-300 p-2">
                    <option value="low">Low</option>
                    <option value="medium" selected>Medium</option>
                    <option value="high">High</option>
                </select>
                <button id="add-new-task-btn" class="bg-[#E42642] text-white py-2 px-4 rounded-md">Add</button>
            </div>

            <div class="flex justify-end gap-2">
                <button id="task-edit-cancel" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-md">Cancel</button>
                <button id="task-edit-save" class="bg-[#10b981] text-white py-2 px-4 rounded-md">Save Changes</button>
            </div>
        </div>
    </div>

    <div id="music-modal" class="modal">
        <div class="modal-content">
            <span id="music-close" class="close-btn">&times;</span>
            <h3 class="text-xl font-semibold mb-3">Music Genres</h3>
            <p class="small-muted mb-3">Click a genre to open YouTube. Use edit/delete to manage your list. Changes saved automatically.</p>
            <div id="genres-list" class="space-y-2 mb-4"></div>

            <h4 class="font-semibold mb-2">Add new genre</h4>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-4">
                <input id="new-genre-name" type="text" placeholder="Genre (e.g., Lo-Fi Hip Hop)" class="rounded-md border-gray-300 p-2 md:col-span-2">
                <input id="new-genre-link" type="text" placeholder="YouTube search or playlist link" class="rounded-md border-gray-300 p-2">
                <button id="add-genre-btn" class="bg-[#E42642] text-white py-2 px-4 rounded-md md:col-span-3">Add Genre</button>
            </div>
            <div class="flex justify-end gap-2">
                <button id="close-music-btn" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-md">Close</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        /* =======================
         * Storage keys
         * ======================= */
        const STORAGE_KEYS = {
            DEADLINES: 'monthlyPlannerDeadlines',
            CLIENTS: 'monthlyPlannerClients',
            ACTIVE_MONTH: 'monthlyPlannerActiveMonth',
            ACTIVE_WEEK: 'monthlyPlannerActiveWeek',
            PLANNER: 'monthlyPlannerData',
            MUSIC: 'monthlyPlannerMusicGenres'
        };
        
        /* =======================
         * Quotes for Welcome Modal
         * ======================= */
        const quotes = [
            { quote: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { quote: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { quote: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { quote: "The secret of getting ahead is getting started.", author: "Mark Twain" },
            { quote: "Your time is limited, don't waste it living someone else's life.", author: "Steve Jobs" },
            { quote: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { quote: "It does not matter how slowly you go as long as you do not stop.", author: "Confucius" },
            { quote: "Everything you‚Äôve ever wanted is on the other side of fear.", author: "George Addair" },
            { quote: "The best time to plant a tree was 20 years ago. The second best time is now.", author: "Chinese Proverb" },
            { quote: "What you get by achieving your goals is not as important as what you become by achieving your goals.", author: "Zig Ziglar" },
            { quote: "Strive not to be a success, but rather to be of value.", author: "Albert Einstein" },
            { quote: "The mind is everything. What you think you become.", author: "Buddha" },
            { quote: "An unexamined life is not worth living.", author: "Socrates" },
            { quote: "Eighty percent of success is showing up.", author: "Woody Allen" },
            { quote: "The only person you are destined to become is the person you decide to be.", author: "Ralph Waldo Emerson" },
            { quote: "Go confidently in the direction of your dreams. Live the life you've imagined.", author: "Henry David Thoreau" },
            { quote: "The journey of a thousand miles begins with a single step.", author: "Lao Tzu" },
            { quote: "Act as if what you do makes a difference. It does.", author: "William James" },
            { quote: "Hardships often prepare ordinary people for an extraordinary destiny.", author: "C.S. Lewis" },
            { quote: "Turn your wounds into wisdom.", author: "Oprah Winfrey" },
            { quote: "The simple act of paying positive attention to people has a great deal to do with productivity.", author: "Tom Peters" },
            { quote: "You can't use up creativity. The more you use, the more you have.", author: "Maya Angelou" },
            { quote: "The most difficult thing is the decision to act, the rest is merely tenacity.", author: "Amelia Earhart" },
            { quote: "I attribute my success to this: I never gave or took any excuse.", author: "Florence Nightingale" },
            { quote: "You miss 100% of the shots you don't take.", author: "Wayne Gretzky" },
            { quote: "Build your own dreams, or someone else will hire you to build theirs.", author: "Farrah Gray" }
        ];

        /* =======================
         * App state
         * ======================= */
        let lastRemovedClient = null;
        let sortDirection = {};
        let currentFilter = 'all';
        let currentDate = new Date('2025-09-09'); // kept as original; swap to new Date() if desired
        let currentMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        let activeWeek = 1;

        /* =======================
         * Default tasks (same as original)
         * ======================= */
        const getDefaultTasks = (week) => {
            const defaults = [
                null,
                {
                    title: 'Content Creation Focus',
                    tasks: {
                        daily: [
                            { text: 'Check CMA inbox for anything urgent.', completed: false, priority: 'medium' },
                            { text: 'Check follow up sheet, confirm meetings and book the boardroom for any meetings.', completed: false, priority: 'high' },
                            { text: 'Get to RMS emails', completed: false, priority: 'medium' }
                        ],
                        weekly: [
                            { text: 'Keyword research for new blogs & Write Blogs. Write social media captions.', completed: false, priority: 'high' },
                            { text: 'Put content into client folders and notify Stephanie with a deadline for the 20th.', completed: false, priority: 'medium' },
                            { text: 'Google Ads Report (Friday)', completed: false, priority: 'high' }
                        ],
                        monthly: [
                            { text: 'Create and schedule content.', completed: false, priority: 'high' },
                            { text: 'SEO optimisation for clients.', completed: false, priority: 'medium' },
                            { text: 'Update SEO sheets.', completed: false, priority: 'low' }
                        ]
                    }
                },
                {
                    title: 'SEO Optimization Focus',
                    tasks: {
                        daily: [
                            { text: 'Check CMA inbox for anything urgent.', completed: false, priority: 'medium' },
                            { text: 'Check follow up sheet, confirm meetings and book the boardroom for any meetings.', completed: false, priority: 'high' },
                            { text: 'Get to RMS emails', completed: false, priority: 'medium' }
                        ],
                        weekly: [
                            { text: 'On-Page SEO keywords. Meta Descriptions. Image Alt tags.', completed: false, priority: 'high' },
                            { text: 'Google Ads Report (Friday)', completed: false, priority: 'high' }
                        ],
                        monthly: []
                    }
                },
                {
                    title: 'Content Review & Reporting Focus',
                    tasks: {
                        daily: [
                            { text: 'Check CMA inbox for anything urgent.', completed: false, priority: 'medium' },
                            { text: 'Check follow up sheet, confirm meetings and book the boardroom for any meetings.', completed: false, priority: 'high' },
                            { text: 'Get to RMS emails', completed: false, priority: 'medium' }
                        ],
                        weekly: [
                            { text: 'Send out SEO report to all clients (Wednesday).', completed: false, priority: 'high' },
                            { text: 'Mail shots (Thursday).', completed: false, priority: 'medium' },
                            { text: 'Get content from Stephanie.', completed: false, priority: 'medium' },
                            { text: 'Google Ads Report (Friday)', completed: false, priority: 'high' }
                        ],
                        monthly: []
                    }
                },
                {
                    title: 'Content Scheduling Focus',
                    tasks: {
                        daily: [
                            { text: 'Check CMA inbox for anything urgent.', completed: false, priority: 'medium' },
                            { text: 'Check follow up sheet, confirm meetings and book the boardroom for any meetings.', completed: false, priority: 'high' },
                            { text: 'Get to RMS emails', completed: false, priority: 'medium' }
                        ],
                        weekly: [
                            { text: 'Schedule content for the coming month.', completed: false, priority: 'high' },
                            { text: 'Brainstorm ideas.', completed: false, priority: 'low' },
                            { text: 'Google Ads Report (Friday)', completed: false, priority: 'high' }
                        ],
                        monthly: []
                    }
                }
            ];
            return defaults[week] || { title: `Week ${week}`, tasks: { daily: [], weekly: [], monthly: [] } };
        };

        /* =======================
         * Storage helpers
         * ======================= */
        const loadData = (key) => {
            const data = localStorage.getItem(key);
            return data ? JSON.parse(data) : null;
        };
        const saveData = (key, data) => localStorage.setItem(key, JSON.stringify(data));

        /* =======================
         * Initialize stored data
         * ======================= */
        let plannerData = loadData(STORAGE_KEYS.PLANNER) || {};
        const monthKeyInit = currentMonth.toISOString().slice(0,7);
        if (!plannerData[monthKeyInit]) plannerData[monthKeyInit] = { weeks: [null, getDefaultTasks(1), getDefaultTasks(2), getDefaultTasks(3), getDefaultTasks(4)] };

        let deadlines = loadData(STORAGE_KEYS.DEADLINES) || [];
        let clientData = loadData(STORAGE_KEYS.CLIENTS) || [
            { company: 'Prominent Roofing', services: 'Google Ads, 1 SEO blog, 4 posts', complete: false },
            { company: 'CFO Connect', services: 'Google Ads, 1 SEO blog', complete: false },
            { company: 'The Green Zone', services: 'Google Ads, 1 SEO blog, 8 posts', complete: false },
            { company: 'Atzaro', services: 'Google Ads, 4 SEO blogs, 16 posts', complete: false },
            { company: 'Landy Logic', services: 'Google Ads, 4 posts', complete: false },
            { company: 'Absolute Ablutions', services: 'Google Ads, 2 SEO blogs', complete: false }
        ];
        const savedMonth = loadData(STORAGE_KEYS.ACTIVE_MONTH);
        if (savedMonth) currentMonth = new Date(savedMonth);
        activeWeek = parseInt(loadData(STORAGE_KEYS.ACTIVE_WEEK)) || 1;

        // Music genres (load or default)
        const defaultGenres = [
            { name: 'Lo-Fi Hip Hop', url: 'https://www.youtube.com/results?search_query=lofi+hip+hop' },
            { name: 'Jazz', url: 'https://www.youtube.com/results?search_query=jazz+playlist' },
            { name: 'Classical', url: 'https://www.youtube.com/results?search_query=classical+music' },
            { name: 'Deep House', url: 'https://www.youtube.com/results?search_query=deep+house' },
            { name: 'Focus / Study', url: 'https://www.youtube.com/results?search_query=focus+study+music' },
            { name: 'Rock', url: 'https://www.youtube.com/results?search_query=rock+playlist' }
        ];
        let musicGenres = loadData(STORAGE_KEYS.MUSIC) || defaultGenres.slice();

        /* =======================
         * DOM references
         * ======================= */
        const prevMonthBtn = document.getElementById('prev-month');
        const nextMonthBtn = document.getElementById('next-month');
        const currentMonthSpan = document.getElementById('current-month');
        const navigation = document.getElementById('week-navigation');
        const contentContainer = document.getElementById('planner-content');
        const monthlyProgressFill = document.getElementById('monthly-progress-fill');
        const monthlyProgressText = document.getElementById('monthly-progress-text');
        const deadlineForm = document.getElementById('add-deadline-form');
        const deadlineList = document.getElementById('deadline-list');
        const clientTableBody = document.getElementById('client-table-body');
        const addClientBtn = document.getElementById('add-client-btn');
        const undoClientBtn = document.getElementById('undo-client-btn');
        const filterClientsSelect = document.getElementById('filter-clients');
        const sortableHeaders = document.querySelectorAll('.sortable-header');

        // Add client modal refs
        const addClientModal = document.getElementById('add-client-modal');
        const newClientForm = document.getElementById('new-client-form');
        const newClientCompanyInput = document.getElementById('new-client-company');
        const newClientServicesInput = document.getElementById('new-client-services');
        const closeAddClientBtn = document.getElementById('close-modal-btn');
        const cancelNewClientBtn = document.getElementById('cancel-new-client-btn');

        // Task editor modal refs
        const taskEditModal = document.getElementById('task-edit-modal');
        const taskEditClose = document.getElementById('task-edit-close');
        const taskEditTitle = document.getElementById('task-edit-title');
        const taskEditList = document.getElementById('task-edit-list');
        const newTaskText = document.getElementById('new-task-text');
        const newTaskPriority = document.getElementById('new-task-priority');
        const addNewTaskBtn = document.getElementById('add-new-task-btn');
        const taskEditCancel = document.getElementById('task-edit-cancel');
        const taskEditSave = document.getElementById('task-edit-save');

        // Music modal refs
        const musicBtn = document.getElementById('musicBtn');
        const musicModal = document.getElementById('music-modal');
        const musicClose = document.getElementById('music-close');
        const closeMusicBtn = document.getElementById('close-music-btn');
        const genresListEl = document.getElementById('genres-list');
        const newGenreName = document.getElementById('new-genre-name');
        const newGenreLink = document.getElementById('new-genre-link');
        const addGenreBtn = document.getElementById('add-genre-btn');
        
        // Welcome modal refs
        const welcomeModal = document.getElementById('welcome-modal');
        const dailyQuoteContainer = document.getElementById('daily-quote-container');
        const closeWelcomeModalBtn = document.getElementById('close-welcome-modal');


        /* =======================
         * helper functions
         * ======================= */
        const getDayOfYear = () => {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        };

        const setupWelcomeModal = () => {
            // Select a quote based on the day of the year
            const dayIndex = getDayOfYear();
            const quoteIndex = dayIndex % quotes.length;
            const { quote, author } = quotes[quoteIndex];
            
            // Display the quote
            dailyQuoteContainer.innerHTML = `"${quote}"<br><span class="text-base not-italic font-medium text-gray-500 mt-2 block">- ${author}</span>`;
            
            // Function to close the modal
            const closeModal = () => {
                welcomeModal.style.display = 'none';
            };

            // Event listeners to close
            closeWelcomeModalBtn.addEventListener('click', closeModal);
            welcomeModal.addEventListener('click', (e) => {
                if (e.target === welcomeModal) {
                    closeModal();
                }
            });
        };
         
        const getMonthKey = date => date.toISOString().slice(0,7);
        const getWeeksInMonth = (date) => {
            const year = date.getFullYear();
            const month = date.getMonth();
            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            return Math.ceil((daysInMonth + firstDay) / 7);
        };
        const calculateProgress = tasks => {
            const all = [...tasks.daily, ...tasks.weekly, ...tasks.monthly];
            if (all.length === 0) return 0;
            const completed = all.filter(t=>t.completed).length;
            return Math.round((completed / all.length) * 100);
        };
        const calculateMonthlyProgress = monthData => {
            let total = 0, done = 0;
            monthData.weeks.forEach(w => {
                if (!w) return;
                const all = [...w.tasks.daily, ...w.tasks.weekly, ...w.tasks.monthly];
                total += all.length;
                done += all.filter(t=>t.completed).length;
            });
            return total > 0 ? Math.round((done / total) * 100) : 0;
        };
        const escapeHtml = (unsafe) => {
            return unsafe.replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'})[m]; });
        };

        /* =======================
         * Renders (weeks, deadlines, clients)
         * ======================= */
        const renderMonthNavigation = () => {
            currentMonthSpan.textContent = currentMonth.toLocaleString('default',{month:'long',year:'numeric'});
        };
        const renderWeekNavigation = () => {
            navigation.innerHTML = '';
            const weeks = getWeeksInMonth(currentMonth);
            for (let i = 1; i <= weeks; i++){
                const btn = document.createElement('button');
                btn.dataset.week = i;
                btn.className = 'nav-btn w-1/4 py-3 px-2 text-center rounded-lg text-gray-700';
                btn.role = 'tab';
                btn.ariaSelected = (i === activeWeek) ? 'true' : 'false';
                btn.textContent = `Week ${i}`;
                if (i === activeWeek) btn.classList.add('active');
                navigation.appendChild(btn);
            }
        };

        // Task editor context & open/close
        let taskEditorContext = { monthKey:null, week:null, type:null };
        const openTaskEditor = (monthKey, week, type) => {
            taskEditorContext = { monthKey, week, type };
            const weekData = plannerData[monthKey].weeks[week] || getDefaultTasks(week);
            const tasks = weekData.tasks[type];
            taskEditTitle.textContent = `${weekData.title} ‚Äî ${type[0].toUpperCase() + type.slice(1)} Tasks`;
            taskEditList.innerHTML = '';
            tasks.forEach((t, idx)=>{
                const div = document.createElement('div');
                div.className = 'task-edit-item';
                div.dataset.index = idx;
                div.innerHTML = `
                    <input type="text" class="rounded-md border-gray-300 p-2" value="${escapeHtml(t.text)}">
                    <select class="task-priority rounded-md p-2">
                        <option value="low" ${t.priority === 'low' ? 'selected' : ''}>Low</option>
                        <option value="medium" ${t.priority === 'medium' ? 'selected' : ''}>Medium</option>
                        <option value="high" ${t.priority === 'high' ? 'selected' : ''}>High</option>
                    </select>
                    <label class="flex items-center gap-2"><input type="checkbox" class="task-completed" ${t.completed ? 'checked' : ''}> Done</label>
                    <button class="ml-2 remove-task-btn text-red-500">Delete</button>
                `;
                taskEditList.appendChild(div);
            });
            // show modal
            taskEditModal.style.display = 'flex';
            newTaskText.value = '';
            newTaskPriority.value = 'medium';
            newTaskText.focus();
        };
        const closeTaskEditor = () => {
            taskEditModal.style.display = 'none';
            taskEditorContext = { monthKey:null, week:null, type:null };
        };

        // Render week content (includes edit buttons)
        const renderWeekContent = (week) => {
            const monthKey = getMonthKey(currentMonth);
            if (!plannerData[monthKey]) {
                plannerData[monthKey] = { weeks: [] };
            }
            const weekData = plannerData[monthKey].weeks[week] || getDefaultTasks(week);
            plannerData[monthKey].weeks[week] = weekData;
            const progress = calculateProgress(weekData.tasks);

            let monthlyTasksHtml = '';
            if (weekData.tasks.monthly.length > 0) {
                monthlyTasksHtml = `
                    <div class="task-card bg-[var(--card-bg)] p-6 rounded-xl shadow-sm">
                        <div class="card-header mb-3">
                            <h3 class="text-xl font-semibold">Monthly Tasks</h3>
                            <button class="edit-tasks-btn" data-week="${week}" data-type="monthly">Edit Tasks</button>
                        </div>
                        <ul id="monthly-tasks-${week}" class="text-[var(--text-color)]" draggable="true">
                            ${weekData.tasks.monthly.map((task,i)=>`
                                <li data-type="monthly" data-index="${i}">
                                    <input type="checkbox" id="task-${week}-monthly-${i}" class="task-checkbox mr-2" ${task.completed ? 'checked' : ''}>
                                    <label for="task-${week}-monthly-${i}" class="${task.completed ? 'completed' : ''}">${escapeHtml(task.text)}</label>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            contentContainer.innerHTML = `
                <section id="week-${week}-content" class="bg-gray-100 p-6 rounded-xl">
                    <h2 class="text-2xl font-bold mb-4 text-center">${escapeHtml(weekData.title)}</h2>
                    <div class="mb-4">
                        <div class="progress-bar"><div class="progress-fill" style="width:${progress}%"></div></div>
                        <p class="text-sm text-gray-600 mt-1 text-center">${progress}% Complete</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="task-card bg-[var(--card-bg)] p-6 rounded-xl shadow-sm">
                            <div class="card-header mb-3">
                                <h3 class="text-xl font-semibold">Daily Tasks</h3>
                                <button class="edit-tasks-btn" data-week="${week}" data-type="daily">Edit Tasks</button>
                            </div>
                            <ul id="daily-tasks-${week}" class="text-[var(--text-color)]" draggable="true">
                                ${weekData.tasks.daily.map((task,i)=>`
                                    <li data-type="daily" data-index="${i}">
                                        <input type="checkbox" id="task-${week}-daily-${i}" class="task-checkbox mr-2" ${task.completed ? 'checked' : ''}>
                                        <label for="task-${week}-daily-${i}" class="${task.completed ? 'completed' : ''}">${escapeHtml(task.text)}</label>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="task-card bg-[var(--card-bg)] p-6 rounded-xl shadow-sm">
                             <div class="card-header mb-3">
                                <h3 class="text-xl font-semibold">Weekly Tasks</h3>
                                <button class="edit-tasks-btn" data-week="${week}" data-type="weekly">Edit Tasks</button>
                            </div>
                            <ul id="weekly-tasks-${week}" class="text-[var(--text-color)]" draggable="true">
                                ${weekData.tasks.weekly.map((task,i)=>`
                                    <li data-type="weekly" data-index="${i}">
                                        <input type="checkbox" id="task-${week}-weekly-${i}" class="task-checkbox mr-2" ${task.completed ? 'checked' : ''}>
                                        <label for="task-${week}-weekly-${i}" class="${task.completed ? 'completed' : ''}">${escapeHtml(task.text)}</label>
                                    </li>
                                `).join('')}
                            </ul>
                        </div>
                    </div>
                    ${monthlyTasksHtml ? `<div class="mt-6">${monthlyTasksHtml}</div>` : ''}
                </section>
            `;
        };

        const updateMonthlyProgress = () => {
            const monthKey = getMonthKey(currentMonth);
            const monthData = plannerData[monthKey];
            if (!monthData) return;
            const progress = calculateMonthlyProgress(monthData);
            monthlyProgressFill.style.width = `${progress}%`;
            monthlyProgressText.textContent = `${progress}% Complete`;
        };
        
        const renderDeadlines = () => {
            deadlineList.innerHTML = '';
            deadlines
                .sort((a,b) => new Date(a.date) - new Date(b.date))
                .forEach((d, i) => {
                    const li = document.createElement('li');
                    const deadlineDate = new Date(d.date + 'T00:00:00'); // Treat date as local
                    const today = new Date();
                    today.setHours(0,0,0,0);
                    const isOverdue = deadlineDate < today;

                    li.className = `flex items-center justify-between bg-gray-50 p-3 rounded-lg ${isOverdue ? 'border-l-4 border-red-500' : ''}`;
                    li.innerHTML = `
                        <div>
                            <p class="font-bold text-gray-800 ${isOverdue ? 'overdue' : ''}">${escapeHtml(d.task)}</p>
                            <p class="text-sm text-gray-500">${escapeHtml(d.client)} - <span class="${isOverdue ? 'overdue' : ''}">Due: ${deadlineDate.toLocaleDateString()}</span></p>
                        </div>
                        <button data-index="${i}" class="remove-deadline-btn text-red-500 hover:text-red-700 font-bold">‚úï</button>
                    `;
                    deadlineList.appendChild(li);
                });
        };

        const renderClients = () => {
            const filteredData = clientData.filter(c => {
                if (currentFilter === 'all') return true;
                return currentFilter === 'complete' ? c.complete : !c.complete;
            });

            clientTableBody.innerHTML = '';
            filteredData.forEach((client, index) => {
                const tr = document.createElement('tr');
                tr.className = client.complete ? 'bg-gray-100' : 'bg-white';
                tr.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap"><div class="font-medium text-gray-800">${escapeHtml(client.company)}</div></td>
                    <td class="px-4 py-3 whitespace-nowrap"><div class="text-gray-600">${escapeHtml(client.services)}</div></td>
                    <td class="px-4 py-3 whitespace-nowrap text-center">
                        <input type="checkbox" data-index="${index}" class="client-complete-checkbox h-5 w-5 rounded" ${client.complete ? 'checked' : ''}>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-center">
                        <button data-index="${index}" class="remove-client-btn text-red-500 hover:text-red-700">Remove</button>
                    </td>
                `;
                clientTableBody.appendChild(tr);
            });
        };
        
        const renderMusicGenres = () => {
            genresListEl.innerHTML = '';
            musicGenres.forEach((g,i) => {
                const row = document.createElement('div');
                row.className = 'genre-row hover:bg-gray-100';
                row.innerHTML = `
                    <div class="flex-grow">
                        <a href="${escapeHtml(g.url)}" target="_blank" class="font-semibold text-gray-800">${escapeHtml(g.name)}</a>
                        <p class="small-muted">${escapeHtml(g.url)}</p>
                    </div>
                    <div class="genre-actions">
                        <button class="edit-genre-btn" data-index="${i}">‚úèÔ∏è</button>
                        <button class="delete-genre-btn" data-index="${i}">üóëÔ∏è</button>
                    </div>
                `;
                genresListEl.appendChild(row);
            });
        };

        const addEventListeners = () => {
            prevMonthBtn.addEventListener('click', () => {
                currentMonth.setMonth(currentMonth.getMonth() - 1);
                renderMonthNavigation();
                renderWeekNavigation();
                renderWeekContent(activeWeek);
                updateMonthlyProgress();
                saveData(STORAGE_KEYS.ACTIVE_MONTH, currentMonth.toISOString());
            });

            nextMonthBtn.addEventListener('click', () => {
                currentMonth.setMonth(currentMonth.getMonth() + 1);
                renderMonthNavigation();
                renderWeekNavigation();
                renderWeekContent(activeWeek);
                updateMonthlyProgress();
                saveData(STORAGE_KEYS.ACTIVE_MONTH, currentMonth.toISOString());
            });

            navigation.addEventListener('click', (e) => {
                if (e.target.matches('.nav-btn')) {
                    activeWeek = parseInt(e.target.dataset.week);
                    renderWeekNavigation();
                    renderWeekContent(activeWeek);
                    saveData(STORAGE_KEYS.ACTIVE_WEEK, activeWeek);
                }
            });

            contentContainer.addEventListener('change', (e) => {
                if (e.target.matches('.task-checkbox')) {
                    const li = e.target.closest('li');
                    const { type, index } = li.dataset;
                    const monthKey = getMonthKey(currentMonth);
                    plannerData[monthKey].weeks[activeWeek].tasks[type][index].completed = e.target.checked;
                    saveData(STORAGE_KEYS.PLANNER, plannerData);
                    renderWeekContent(activeWeek);
                    updateMonthlyProgress();
                }
            });
            
            contentContainer.addEventListener('click', e => {
                if (e.target.matches('.edit-tasks-btn')) {
                    const { week, type } = e.target.dataset;
                    openTaskEditor(getMonthKey(currentMonth), parseInt(week), type);
                }
            });

            deadlineForm.addEventListener('submit', (e) => {
                e.preventDefault();
                deadlines.push({ date: e.target['deadline-date'].value, task: e.target['deadline-task'].value, client: e.target['deadline-client'].value });
                saveData(STORAGE_KEYS.DEADLINES, deadlines);
                renderDeadlines();
                e.target.reset();
            });

            deadlineList.addEventListener('click', (e) => {
                if (e.target.matches('.remove-deadline-btn')) {
                    deadlines.splice(e.target.dataset.index, 1);
                    saveData(STORAGE_KEYS.DEADLINES, deadlines);
                    renderDeadlines();
                }
            });
            
            clientTableBody.addEventListener('click', (e) => {
                const index = e.target.dataset.index;
                if (e.target.matches('.remove-client-btn')) {
                    lastRemovedClient = { client: clientData[index], index: index };
                    clientData.splice(index, 1);
                    undoClientBtn.classList.remove('hidden');
                    setTimeout(() => undoClientBtn.classList.add('hidden'), 5000);
                } else if (e.target.matches('.client-complete-checkbox')) {
                    clientData[index].complete = e.target.checked;
                }
                saveData(STORAGE_KEYS.CLIENTS, clientData);
                renderClients();
            });

            undoClientBtn.addEventListener('click', () => {
                if (lastRemovedClient) {
                    clientData.splice(lastRemovedClient.index, 0, lastRemovedClient.client);
                    lastRemovedClient = null;
                    undoClientBtn.classList.add('hidden');
                    saveData(STORAGE_KEYS.CLIENTS, clientData);
                    renderClients();
                }
            });
            
            filterClientsSelect.addEventListener('change', e => {
                currentFilter = e.target.value;
                renderClients();
            });
            
            sortableHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    const key = header.dataset.sortKey;
                    sortDirection[key] = sortDirection[key] === 'asc' ? 'desc' : 'asc';
                    clientData.sort((a,b) => {
                        const valA = a[key].toLowerCase();
                        const valB = b[key].toLowerCase();
                        if (valA < valB) return sortDirection[key] === 'asc' ? -1 : 1;
                        if (valA > valB) return sortDirection[key] === 'asc' ? 1 : -1;
                        return 0;
                    });
                    renderClients();
                });
            });
            
            // Modal event listeners
            addClientBtn.addEventListener('click', () => addClientModal.style.display = 'flex');
            closeAddClientBtn.addEventListener('click', () => addClientModal.style.display = 'none');
            cancelNewClientBtn.addEventListener('click', () => addClientModal.style.display = 'none');
            
            newClientForm.addEventListener('submit', (e) => {
                e.preventDefault();
                clientData.push({ company: newClientCompanyInput.value, services: newClientServicesInput.value, complete: false });
                saveData(STORAGE_KEYS.CLIENTS, clientData);
                renderClients();
                addClientModal.style.display = 'none';
                e.target.reset();
            });

            // Task Editor Modal events
            taskEditClose.addEventListener('click', closeTaskEditor);
            taskEditCancel.addEventListener('click', closeTaskEditor);
            taskEditSave.addEventListener('click', () => {
                const { monthKey, week, type } = taskEditorContext;
                const newTasks = [];
                taskEditList.querySelectorAll('.task-edit-item').forEach(item => {
                    newTasks.push({
                        text: item.querySelector('input[type="text"]').value,
                        priority: item.querySelector('.task-priority').value,
                        completed: item.querySelector('.task-completed').checked
                    });
                });
                plannerData[monthKey].weeks[week].tasks[type] = newTasks;
                saveData(STORAGE_KEYS.PLANNER, plannerData);
                renderWeekContent(week);
                updateMonthlyProgress();
                closeTaskEditor();
            });

            addNewTaskBtn.addEventListener('click', () => {
                const text = newTaskText.value.trim();
                if (!text) return;
                const { monthKey, week, type } = taskEditorContext;
                const tasks = plannerData[monthKey].weeks[week].tasks[type];
                tasks.push({
                    text: text,
                    priority: newTaskPriority.value,
                    completed: false
                });
                openTaskEditor(monthKey, week, type); // Re-opens to refresh list
            });
            
            taskEditList.addEventListener('click', e => {
                if (e.target.matches('.remove-task-btn')) {
                    e.target.closest('.task-edit-item').remove();
                }
            });

            // Music Modal Events
            musicBtn.addEventListener('click', () => musicModal.style.display = 'flex');
            musicClose.addEventListener('click', () => musicModal.style.display = 'none');
            closeMusicBtn.addEventListener('click', () => musicModal.style.display = 'none');
            
            addGenreBtn.addEventListener('click', () => {
                const name = newGenreName.value.trim();
                const url = newGenreLink.value.trim();
                if (!name || !url) return;
                musicGenres.push({name, url});
                saveData(STORAGE_KEYS.MUSIC, musicGenres);
                renderMusicGenres();
                newGenreName.value = '';
                newGenreLink.value = '';
            });
            
            genresListEl.addEventListener('click', e => {
                 if (e.target.matches('.delete-genre-btn')) {
                    const idx = parseInt(e.target.dataset.index);
                    musicGenres.splice(idx, 1);
                    saveData(STORAGE_KEYS.MUSIC, musicGenres);
                    renderMusicGenres();
                } else if (e.target.matches('.edit-genre-btn')) {
                    const idx = parseInt(e.target.dataset.index);
                    const genre = musicGenres[idx];
                    newGenreName.value = genre.name;
                    newGenreLink.value = genre.url;
                    musicGenres.splice(idx, 1); // remove to re-add on save
                }
            });
        };

        const init = () => {
            setupWelcomeModal(); // Show welcome modal on start
            renderMonthNavigation();
            renderWeekNavigation();
            renderWeekContent(activeWeek);
            updateMonthlyProgress();
            renderDeadlines();
            renderClients();
            renderMusicGenres();
            addEventListeners();
        };

        init();
    });
    </script>
</body>
</html>
