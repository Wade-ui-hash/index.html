<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="utf-8" />
Â  Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  Â  <title>Interactive Monthly Planner</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  :root{
Â  Â  Â  Â  Â  Â  --bg-color:#F5F5F5;
Â  Â  Â  Â  Â  Â  --text-color:#333333;
Â  Â  Â  Â  Â  Â  --card-bg:#FFFFFF;
Â  Â  Â  Â  Â  Â  --accent-color:#E42642;
Â  Â  Â  Â  Â  Â  --completed-color:#B5B5B5;
Â  Â  Â  Â  Â  Â  --overdue-color:#E42642;
Â  Â  Â  Â  Â  Â  --progress-bg:#e5e7eb;
Â  Â  Â  Â  Â  Â  --progress-fill:#10b981;
Â  Â  Â  Â  }
Â  Â  Â  Â  body{font-family:'Inter',sans-serif;background-color:var(--bg-color);color:var(--text-color)}
Â  Â  Â  Â  .nav-btn{transition:all .3s ease}
Â  Â  Â  Â  .nav-btn.active{background-color:var(--accent-color);color:#fff;font-weight:600}
Â  Â  Â  Â  .task-card ul{list-style:none;padding:0;margin:0}
Â  Â  Â  Â  .task-card ul li{display:flex;align-items:center;margin-bottom:.5rem;cursor:grab}
Â  Â  Â  Â  .task-card ul li:active{cursor:grabbing}
Â  Â  Â  Â  .completed{text-decoration:line-through;color:var(--completed-color)}
Â  Â  Â  Â  .sortable-header{cursor:pointer;user-select:none}
Â  Â  Â  Â  .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.5);align-items:center;justify-content:center}
Â  Â  Â  Â  .modal-content{background-color:var(--card-bg);padding:24px;border-radius:.75rem;box-shadow:0 4px 6px rgba(0,0,0,.1);max-width:680px;width:94%}
Â  Â  Â  Â  .close-btn{color:#aaa;float:right;font-size:28px;font-weight:bold}
Â  Â  Â  Â  .close-btn:hover,.close-btn:focus{color:var(--text-color);text-decoration:none;cursor:pointer}
Â  Â  Â  Â  .overdue{color:var(--overdue-color);font-weight:bold}
Â  Â  Â  Â  .progress-bar{background-color:var(--progress-bg);height:8px;border-radius:9999px;overflow:hidden}
Â  Â  Â  Â  .progress-fill{background-color:var(--progress-fill);height:100%;transition:width .3s ease}
Â  Â  Â  Â  .error-message{color:#E42642;font-size:.875rem;margin-top:.25rem}
Â  Â  Â  Â  [role="tab"]:focus{outline:2px solid var(--accent-color)}
Â  Â  Â  Â  /* card header & edit button */
Â  Â  Â  Â  .card-header{display:flex;align-items:center;justify-content:space-between;gap:8px}
Â  Â  Â  Â  .edit-tasks-btn{background:transparent;border:1px solid rgba(0,0,0,.08);padding:6px 10px;border-radius:8px;font-size:.875rem;cursor:pointer}
Â  Â  Â  Â  .edit-tasks-btn:hover{background:rgba(0,0,0,.03)}
Â  Â  Â  Â  .task-edit-list{max-height:320px;overflow:auto;margin-bottom:12px}
Â  Â  Â  Â  .task-edit-item{display:flex;gap:8px;align-items:center;margin-bottom:8px}
Â  Â  Â  Â  .music-btn{background:var(--accent-color);color:#fff;padding:.5rem .75rem;border-radius:.6rem;font-weight:600;display:inline-flex;align-items:center;gap:.5rem;border:none;cursor:pointer}
Â  Â  Â  Â  .music-btn:hover{opacity:.95}
Â  Â  Â  Â  .music-top-right{position:absolute;right:0;top:0}
Â  Â  Â  Â  header.relative{position:relative}
Â  Â  Â  Â  /* music modal specific */
Â  Â  Â  Â  .genre-row{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:8px;border-radius:8px}
Â  Â  Â  Â  .genre-actions button{margin-left:6px}
Â  Â  Â  Â  .small-muted{font-size:.875rem;color:#6b7280}
Â  Â  Â  Â  /* responsive small tune */
Â  Â  Â  Â  @media (max-width:640px){
Â  Â  Â  Â  Â  Â  .music-top-right{position:static;margin-top:.5rem}
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="antialiased text-gray-900">
Â  Â  <div class="container mx-auto p-4 sm:p-6 md:p-8 max-w-7xl">
Â  Â  Â  Â  Â  Â  Â  Â  <header class="text-center mb-8 relative">
Â  Â  Â  Â  Â  Â  <h1 class="text-4xl font-bold text-gray-800">Monthly Work Planner</h1>
Â  Â  Â  Â  Â  Â  <p class="text-lg text-gray-600 mt-2 w-full">A dynamic and interactive schedule to keep you organized.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="music-top-right absolute right-0 top-0">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="musicBtn" class="music-btn mr-2" title="Open Music genres">ðŸŽµ Music</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </header>

Â  Â  Â  Â  <main>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <nav id="month-navigation" class="flex justify-center items-center bg-white rounded-xl shadow-sm p-2 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="prev-month" class="nav-btn px-4 py-2 text-gray-700">&lt; Prev</button>
Â  Â  Â  Â  Â  Â  Â  Â  <span id="current-month" class="px-4 py-2 font-semibold"></span>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="next-month" class="nav-btn px-4 py-2 text-gray-700">Next &gt;</button>
Â  Â  Â  Â  Â  Â  </nav>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <nav id="week-navigation" role="tablist" class="flex justify-center items-center bg-white rounded-xl shadow-sm p-2 mb-8"></nav>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="monthly-progress" class="mb-8 bg-white p-6 rounded-xl shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-gray-800 mb-4">Monthly Progress</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="progress-bar mb-2"><div id="monthly-progress-fill" class="progress-fill" style="width:0%"></div></div>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="monthly-progress-text" class="text-sm text-gray-600 text-center">0% Complete</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="planner-content"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <section id="deadlines-section" class="mt-10 bg-white p-6 rounded-xl shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-gray-200 pb-2">Upcoming Deadlines</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600 mb-6">Use this section to track specific deadlines for projects and tasks. Add new deadlines using the form below.</p>
Â  Â  Â  Â  Â  Â  Â  Â  <ul id="deadline-list" class="space-y-3 mb-8"></ul>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-semibold text-gray-800 mb-3">Add a New Deadline</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form id="add-deadline-form" class="grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="deadline-date" class="block text-sm font-medium text-gray-700">Date</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="deadline-date" type="date" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="deadline-date-error" class="error-message hidden">Please select a date.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="deadline-task" class="block text-sm font-medium text-gray-700">Project/Task Name</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="deadline-task" type="text" placeholder="e.g., Finalize Q3 Report" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="deadline-task-error" class="error-message hidden">Please enter a task name.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="md:col-span-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="deadline-client" class="block text-sm font-medium text-gray-700">Client</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="deadline-client" type="text" placeholder="e.g., Client Inc." required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="deadline-client-error" class="error-message hidden">Please enter a client.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="w-full md:w-auto md:col-start-4 bg-[#E42642] text-white font-semibold py-2 px-6 rounded-lg hover:bg-opacity-90 transition-colors">Add Deadline</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <section id="clients-section" class="mt-10 bg-white p-6 rounded-xl shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-2xl font-bold text-gray-800 mb-4 border-b-2 border-gray-200 pb-2">Active Clients</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="filter-clients" class="text-sm font-medium text-gray-700">Filter by:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="filter-clients" class="bg-white text-gray-900 rounded-md border-gray-300 shadow-sm p-2 text-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="all">All</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="incomplete">Incomplete</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="complete">Complete</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="undo-client-btn" class="bg-gray-200 text-gray-600 font-semibold py-2 px-6 rounded-lg hidden">Undo Remove</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-client-btn" class="bg-[#E42642] text-white font-semibold py-2 px-6 rounded-lg">Add New Client</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="overflow-x-auto">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="min-w-full divide-y divide-gray-200">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider sortable-header" data-sort-key="company">Company</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-left text-sm font-semibold text-gray-700 uppercase tracking-wider sortable-header" data-sort-key="services">Services</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider">Complete</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="px-4 py-3 text-center text-sm font-semibold text-gray-700 uppercase tracking-wider">Actions</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="client-table-body" class="bg-white divide-y divide-gray-200"></tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>
Â  Â  Â  Â  </main>
Â  Â  </div>

Â  Â  Â  Â  <div id="add-client-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content p-6 rounded-xl shadow-lg">
Â  Â  Â  Â  Â  Â  <span id="close-modal-btn" class="close-btn">&times;</span>
Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-semibold text-gray-800 mb-4">Add New Client</h3>
Â  Â  Â  Â  Â  Â  <form id="new-client-form" class="space-y-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="new-client-company" class="block text-sm font-medium text-gray-700">Company</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="new-client-company" type="text" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="new-client-company-error" class="error-message hidden">Please enter a company name.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="new-client-services" class="block text-sm font-medium text-gray-700">Services</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="new-client-services" type="text" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 bg-white text-gray-900">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="new-client-services-error" class="error-message hidden">Please enter services.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-end gap-2 mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="cancel-new-client-btn" type="button" class="bg-gray-200 text-gray-800 font-semibold py-2 px-6 rounded-lg">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="confirm-new-client-btn" type="submit" class="bg-[#E42642] text-white font-semibold py-2 px-6 rounded-lg">Confirm</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="task-edit-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <span id="task-edit-close" class="close-btn">&times;</span>
Â  Â  Â  Â  Â  Â  <h3 id="task-edit-title" class="text-xl font-semibold mb-3">Edit Tasks</h3>
Â  Â  Â  Â  Â  Â  <div id="task-edit-list" class="task-edit-list mb-3"></div>

Â  Â  Â  Â  Â  Â  <div class="flex gap-2 items-center mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  <input id="new-task-text" type="text" placeholder="New task description" class="w-full rounded-md border-gray-300 p-2">
Â  Â  Â  Â  Â  Â  Â  Â  <select id="new-task-priority" class="rounded-md border-gray-300 p-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="low">Low</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="medium" selected>Medium</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="high">High</option>
Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-new-task-btn" class="bg-[#E42642] text-white py-2 px-4 rounded-md">Add</button>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="flex justify-end gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="task-edit-cancel" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-md">Cancel</button>
Â  Â  Â  Â  Â  Â  Â  Â  <button id="task-edit-save" class="bg-[#10b981] text-white py-2 px-4 rounded-md">Save Changes</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="music-modal" class="modal">
Â  Â  Â  Â  <div class="modal-content">
Â  Â  Â  Â  Â  Â  <span id="music-close" class="close-btn">&times;</span>
Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-semibold mb-3">Music Genres</h3>
Â  Â  Â  Â  Â  Â  <p class="small-muted mb-3">Click a genre to open YouTube. Use edit/delete to manage your list. Changes saved automatically.</p>
Â  Â  Â  Â  Â  Â  <div id="genres-list" class="space-y-2 mb-4"></div>

Â  Â  Â  Â  Â  Â  <h4 class="font-semibold mb-2">Add new genre</h4>
Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-2 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <input id="new-genre-name" type="text" placeholder="Genre (e.g., Lo-Fi Hip Hop)" class="rounded-md border-gray-300 p-2 md:col-span-2">
Â  Â  Â  Â  Â  Â  Â  Â  <input id="new-genre-link" type="text" placeholder="YouTube search or playlist link" class="rounded-md border-gray-300 p-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="add-genre-btn" class="bg-[#E42642] text-white py-2 px-4 rounded-md md:col-span-3">Add Genre</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="flex justify-end gap-2">
Â  Â  Â  Â  Â  Â  Â  Â  <button id="close-music-btn" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-md">Close</button>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <script>
Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â Storage keys
Â  Â  Â  Â  Â  Â ======================= */
Â  Â  Â  Â  const STORAGE_KEYS = {
Â  Â  Â  Â  Â  Â  DEADLINES: 'monthlyPlannerDeadlines',
Â  Â  Â  Â  Â  Â  CLIENTS: 'monthlyPlannerClients',
Â  Â  Â  Â  Â  Â  ACTIVE_MONTH: 'monthlyPlannerActiveMonth',
Â  Â  Â  Â  Â  Â  ACTIVE_WEEK: 'monthlyPlannerActiveWeek',
Â  Â  Â  Â  Â  Â  PLANNER: 'monthlyPlannerData',
Â  Â  Â  Â  Â  Â  MUSIC: 'monthlyPlannerMusicGenres' // new
Â  Â  Â  Â  };

Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â App state
Â  Â  Â  Â  Â  Â ======================= */
Â  Â  Â  Â  let lastRemovedClient = null;
Â  Â  Â  Â  let sortDirection = {};
Â  Â  Â  Â  let currentFilter = 'all';
Â  Â  Â  Â  let currentDate = new Date('2025-09-09'); // kept as original; swap to new Date() if desired
Â  Â  Â  Â  let currentMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
Â  Â  Â  Â  let activeWeek = 1;

Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â Default tasks (same as original)
Â  Â  Â  Â  Â  Â ======================= */
Â  Â  Â  Â  const getDefaultTasks = (week) => {
Â  Â  Â  Â  Â  Â  const defaults = [
Â  Â  Â  Â  Â  Â  Â  Â  null,
Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'Content Creation Focus',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daily: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Check CMA inbox for anything urgent.', completed: false, priority: 'medium' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Check follow up sheet, confirm meetings and book the boardroom for any meetings.', completed: false, priority: 'high' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Get to RMS emails', completed: false, priority: 'medium' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weekly: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Keyword research for new blogs & Write Blogs. Write social media captions.', completed: false, priority: 'high' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Put content into client folders and notify Stephanie with a deadline for the 20th.', completed: false, priority: 'medium' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Google Ads Report (Friday)', completed: false, priority: 'high' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  monthly: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Create and schedule content.', completed: false, priority: 'high' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'SEO optimisation for clients.', completed: false, priority: 'medium' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Update SEO sheets.', completed: false, priority: 'low' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'SEO Optimization Focus',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daily: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Check CMA inbox for anything urgent.', completed: false, priority: 'medium' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Check follow up sheet, confirm meetings and book the boardroom for any meetings.', completed: false, priority: 'high' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Get to RMS emails', completed: false, priority: 'medium' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weekly: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'On-Page SEO keywords. Meta Descriptions. Image Alt tags.', completed: false, priority: 'high' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Google Ads Report (Friday)', completed: false, priority: 'high' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  monthly: []
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'Content Review & Reporting Focus',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daily: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Check CMA inbox for anything urgent.', completed: false, priority: 'medium' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Check follow up sheet, confirm meetings and book the boardroom for any meetings.', completed: false, priority: 'high' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Get to RMS emails', completed: false, priority: 'medium' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weekly: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Send out SEO report to all clients (Wednesday).', completed: false, priority: 'high' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Mail shots (Thursday).', completed: false, priority: 'medium' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Get content from Stephanie.', completed: false, priority: 'medium' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Google Ads Report (Friday)', completed: false, priority: 'high' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  monthly: []
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'Content Scheduling Focus',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  tasks: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  daily: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Check CMA inbox for anything urgent.', completed: false, priority: 'medium' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Check follow up sheet, confirm meetings and book the boardroom for any meetings.', completed: false, priority: 'high' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Get to RMS emails', completed: false, priority: 'medium' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  weekly: [
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Schedule content for the coming month.', completed: false, priority: 'high' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Brainstorm ideas.', completed: false, priority: 'low' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { text: 'Google Ads Report (Friday)', completed: false, priority: 'high' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  monthly: []
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  ];
Â  Â  Â  Â  Â  Â  return defaults[week] || { title: `Week ${week}`, tasks: { daily: [], weekly: [], monthly: [] } };
Â  Â  Â  Â  };

Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â Storage helpers
Â  Â  Â  Â  Â  Â ======================= */
Â  Â  Â  Â  const loadData = (key) => {
Â  Â  Â  Â  Â  Â  const data = localStorage.getItem(key);
Â  Â  Â  Â  Â  Â  return data ? JSON.parse(data) : null;
Â  Â  Â  Â  };
Â  Â  Â  Â  const saveData = (key, data) => localStorage.setItem(key, JSON.stringify(data));

Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â Initialize stored data
Â  Â  Â  Â  Â  Â ======================= */
Â  Â  Â  Â  let plannerData = loadData(STORAGE_KEYS.PLANNER) || {};
Â  Â  Â  Â  const monthKeyInit = currentMonth.toISOString().slice(0,7);
Â  Â  Â  Â  if (!plannerData[monthKeyInit]) plannerData[monthKeyInit] = { weeks: [null, getDefaultTasks(1), getDefaultTasks(2), getDefaultTasks(3), getDefaultTasks(4)] };

Â  Â  Â  Â  let deadlines = loadData(STORAGE_KEYS.DEADLINES) || [];
Â  Â  Â  Â  let clientData = loadData(STORAGE_KEYS.CLIENTS) || [
Â  Â  Â  Â  Â  Â  { company: 'Prominent Roofing', services: 'Google Ads, 1 SEO blog, 4 posts', complete: false },
Â  Â  Â  Â  Â  Â  { company: 'CFO Connect', services: 'Google Ads, 1 SEO blog', complete: false },
Â  Â  Â  Â  Â  Â  { company: 'The Green Zone', services: 'Google Ads, 1 SEO blog, 8 posts', complete: false },
Â  Â  Â  Â  Â  Â  { company: 'Atzaro', services: 'Google Ads, 4 SEO blogs, 16 posts', complete: false },
Â  Â  Â  Â  Â  Â  { company: 'Landy Logic', services: 'Google Ads, 4 posts', complete: false },
Â  Â  Â  Â  Â  Â  { company: 'Absolute Ablutions', services: 'Google Ads, 2 SEO blogs', complete: false }
Â  Â  Â  Â  ];
Â  Â  Â  Â  const savedMonth = loadData(STORAGE_KEYS.ACTIVE_MONTH);
Â  Â  Â  Â  if (savedMonth) currentMonth = new Date(savedMonth);
Â  Â  Â  Â  activeWeek = parseInt(loadData(STORAGE_KEYS.ACTIVE_WEEK)) || 1;

Â  Â  Â  Â  // Music genres (load or default)
Â  Â  Â  Â  const defaultGenres = [
Â  Â  Â  Â  Â  Â  { name: 'Lo-Fi Hip Hop', url: 'https://www.youtube.com/results?search_query=lofi+hip+hop' },
Â  Â  Â  Â  Â  Â  { name: 'Jazz', url: 'https://www.youtube.com/results?search_query=jazz+playlist' },
Â  Â  Â  Â  Â  Â  { name: 'Classical', url: 'https://www.youtube.com/results?search_query=classical+music' },
Â  Â  Â  Â  Â  Â  { name: 'Deep House', url: 'https://www.youtube.com/results?search_query=deep+house' },
Â  Â  Â  Â  Â  Â  { name: 'Focus / Study', url: 'https://www.youtube.com/results?search_query=focus+study+music' },
Â  Â  Â  Â  Â  Â  { name: 'Rock', url: 'https://www.youtube.com/results?search_query=rock+playlist' }
Â  Â  Â  Â  ];
Â  Â  Â  Â  let musicGenres = loadData(STORAGE_KEYS.MUSIC) || defaultGenres.slice();

Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â DOM references
Â  Â  Â  Â  Â  Â ======================= */
Â  Â  Â  Â  const prevMonthBtn = document.getElementById('prev-month');
Â  Â  Â  Â  const nextMonthBtn = document.getElementById('next-month');
Â  Â  Â  Â  const currentMonthSpan = document.getElementById('current-month');
Â  Â  Â  Â  const navigation = document.getElementById('week-navigation');
Â  Â  Â  Â  const contentContainer = document.getElementById('planner-content');
Â  Â  Â  Â  const monthlyProgressFill = document.getElementById('monthly-progress-fill');
Â  Â  Â  Â  const monthlyProgressText = document.getElementById('monthly-progress-text');
Â  Â  Â  Â  const deadlineForm = document.getElementById('add-deadline-form');
Â  Â  Â  Â  const deadlineList = document.getElementById('deadline-list');
Â  Â  Â  Â  const clientTableBody = document.getElementById('client-table-body');
Â  Â  Â  Â  const addClientBtn = document.getElementById('add-client-btn');
Â  Â  Â  Â  const undoClientBtn = document.getElementById('undo-client-btn');
Â  Â  Â  Â  const filterClientsSelect = document.getElementById('filter-clients');
Â  Â  Â  Â  const sortableHeaders = document.querySelectorAll('.sortable-header');

Â  Â  Â  Â  // Add client modal refs
Â  Â  Â  Â  const addClientModal = document.getElementById('add-client-modal');
Â  Â  Â  Â  const newClientForm = document.getElementById('new-client-form');
Â  Â  Â  Â  const newClientCompanyInput = document.getElementById('new-client-company');
Â  Â  Â  Â  const newClientServicesInput = document.getElementById('new-client-services');
Â  Â  Â  Â  const closeAddClientBtn = document.getElementById('close-modal-btn');
Â  Â  Â  Â  const cancelNewClientBtn = document.getElementById('cancel-new-client-btn');

Â  Â  Â  Â  // Task editor modal refs
Â  Â  Â  Â  const taskEditModal = document.getElementById('task-edit-modal');
Â  Â  Â  Â  const taskEditClose = document.getElementById('task-edit-close');
Â  Â  Â  Â  const taskEditTitle = document.getElementById('task-edit-title');
Â  Â  Â  Â  const taskEditList = document.getElementById('task-edit-list');
Â  Â  Â  Â  const newTaskText = document.getElementById('new-task-text');
Â  Â  Â  Â  const newTaskPriority = document.getElementById('new-task-priority');
Â  Â  Â  Â  const addNewTaskBtn = document.getElementById('add-new-task-btn');
Â  Â  Â  Â  const taskEditCancel = document.getElementById('task-edit-cancel');
Â  Â  Â  Â  const taskEditSave = document.getElementById('task-edit-save');

Â  Â  Â  Â  // Music modal refs
Â  Â  Â  Â  const musicBtn = document.getElementById('musicBtn');
Â  Â  Â  Â  const musicModal = document.getElementById('music-modal');
Â  Â  Â  Â  const musicClose = document.getElementById('music-close');
Â  Â  Â  Â  const closeMusicBtn = document.getElementById('close-music-btn');
Â  Â  Â  Â  const genresListEl = document.getElementById('genres-list');
Â  Â  Â  Â  const newGenreName = document.getElementById('new-genre-name');
Â  Â  Â  Â  const newGenreLink = document.getElementById('new-genre-link');
Â  Â  Â  Â  const addGenreBtn = document.getElementById('add-genre-btn');

Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â helper functions
Â  Â  Â  Â  Â  Â ======================= */
Â  Â  Â  Â  const getMonthKey = date => date.toISOString().slice(0,7);
Â  Â  Â  Â  const getWeeksInMonth = (date) => {
Â  Â  Â  Â  Â  Â  const year = date.getFullYear();
Â  Â  Â  Â  Â  Â  const month = date.getMonth();
Â  Â  Â  Â  Â  Â  const firstDay = new Date(year, month, 1).getDay();
Â  Â  Â  Â  Â  Â  const daysInMonth = new Date(year, month+1, 0).getDate();
Â  Â  Â  Â  Â  Â  return Math.ceil((daysInMonth + firstDay) / 7);
Â  Â  Â  Â  };
Â  Â  Â  Â  const calculateProgress = tasks => {
Â  Â  Â  Â  Â  Â  const all = [...tasks.daily, ...tasks.weekly, ...tasks.monthly];
Â  Â  Â  Â  Â  Â  if (all.length === 0) return 0;
Â  Â  Â  Â  Â  Â  const completed = all.filter(t=>t.completed).length;
Â  Â  Â  Â  Â  Â  return Math.round((completed / all.length) * 100);
Â  Â  Â  Â  };
Â  Â  Â  Â  const calculateMonthlyProgress = monthData => {
Â  Â  Â  Â  Â  Â  let total = 0, done = 0;
Â  Â  Â  Â  Â  Â  monthData.weeks.forEach(w => {
Â  Â  Â  Â  Â  Â  Â  Â  if (!w) return;
Â  Â  Â  Â  Â  Â  Â  Â  const all = [...w.tasks.daily, ...w.tasks.weekly, ...w.tasks.monthly];
Â  Â  Â  Â  Â  Â  Â  Â  total += all.length;
Â  Â  Â  Â  Â  Â  Â  Â  done += all.filter(t=>t.completed).length;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  return total>0?Math.round((done/total)*100):0;
Â  Â  Â  Â  };
Â  Â  Â  Â  const escapeHtml = (unsafe) => {
Â  Â  Â  Â  Â  Â  return unsafe.replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'})[m]; });
Â  Â  Â  Â  };

Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â Renders (weeks, deadlines, clients)
Â  Â  Â  Â  Â  Â ======================= */
Â  Â  Â  Â  const renderMonthNavigation = () => {
Â  Â  Â  Â  Â  Â  currentMonthSpan.textContent = currentMonth.toLocaleString('default',{month:'long',year:'numeric'});
Â  Â  Â  Â  };
Â  Â  Â  Â  const renderWeekNavigation = () => {
Â  Â  Â  Â  Â  Â  navigation.innerHTML = '';
Â  Â  Â  Â  Â  Â  const weeks = getWeeksInMonth(currentMonth);
Â  Â  Â  Â  Â  Â  for (let i=1;i<=weeks;i++){
Â  Â  Â  Â  Â  Â  Â  Â  const btn = document.createElement('button');
Â  Â  Â  Â  Â  Â  Â  Â  btn.dataset.week = i;
Â  Â  Â  Â  Â  Â  Â  Â  btn.className = 'nav-btn w-1/4 py-3 px-2 text-center rounded-lg text-gray-700';
Â  Â  Â  Â  Â  Â  Â  Â  btn.role = 'tab';
Â  Â  Â  Â  Â  Â  Â  Â  btn.ariaSelected = (i===activeWeek)?'true':'false';
Â  Â  Â  Â  Â  Â  Â  Â  btn.textContent = `Week ${i}`;
Â  Â  Â  Â  Â  Â  Â  Â  if (i===activeWeek) btn.classList.add('active');
Â  Â  Â  Â  Â  Â  Â  Â  navigation.appendChild(btn);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // Task editor context & open/close
Â  Â  Â  Â  let taskEditorContext = { monthKey:null, week:null, type:null };
Â  Â  Â  Â  const openTaskEditor = (monthKey, week, type) => {
Â  Â  Â  Â  Â  Â  taskEditorContext = { monthKey, week, type };
Â  Â  Â  Â  Â  Â  const weekData = plannerData[monthKey].weeks[week] || getDefaultTasks(week);
Â  Â  Â  Â  Â  Â  const tasks = weekData.tasks[type];
Â  Â  Â  Â  Â  Â  taskEditTitle.textContent = `${weekData.title} â€” ${type[0].toUpperCase()+type.slice(1)} Tasks`;
Â  Â  Â  Â  Â  Â  taskEditList.innerHTML = '';
Â  Â  Â  Â  Â  Â  tasks.forEach((t, idx)=>{
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  div.className = 'task-edit-item';
Â  Â  Â  Â  Â  Â  Â  Â  div.dataset.index = idx;
Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="rounded-md border-gray-300 p-2" value="${escapeHtml(t.text)}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="task-priority rounded-md p-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="low" ${t.priority==='low'?'selected':''}>Low</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="medium" ${t.priority==='medium'?'selected':''}>Medium</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="high" ${t.priority==='high'?'selected':''}>High</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="flex items-center gap-2"><input type="checkbox" class="task-completed" ${t.completed?'checked':''}> Done</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="ml-2 remove-task-btn text-red-500">Delete</button>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  taskEditList.appendChild(div);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  // show modal
Â  Â  Â  Â  Â  Â  taskEditModal.style.display = 'flex';
Â  Â  Â  Â  Â  Â  newTaskText.value = '';
Â  Â  Â  Â  Â  Â  newTaskPriority.value = 'medium';
Â  Â  Â  Â  Â  Â  newTaskText.focus();
Â  Â  Â  Â  };
Â  Â  Â  Â  const closeTaskEditor = () => {
Â  Â  Â  Â  Â  Â  taskEditModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  taskEditorContext = { monthKey:null, week:null, type:null };
Â  Â  Â  Â  };

Â  Â  Â  Â  // Render week content (includes edit buttons)
Â  Â  Â  Â  const renderWeekContent = (week) => {
Â  Â  Â  Â  Â  Â  const monthKey = getMonthKey(currentMonth);
Â  Â  Â  Â  Â  Â  const weekData = plannerData[monthKey].weeks[week] || getDefaultTasks(week);
Â  Â  Â  Â  Â  Â  plannerData[monthKey].weeks[week] = weekData; // Ensure data is stored
Â  Â  Â  Â  Â  Â  const progress = calculateProgress(weekData.tasks);

Â  Â  Â  Â  Â  Â  let monthlyTasksHtml = '';
Â  Â  Â  Â  Â  Â  if (weekData.tasks.monthly.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  monthlyTasksHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-card bg-[var(--card-bg)] p-6 rounded-xl shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-semibold">Monthly Tasks</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="edit-tasks-btn" data-week="${week}" data-type="monthly">Edit Tasks</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul id="monthly-tasks-${week}" class="text-[var(--text-color)]" draggable="true">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${weekData.tasks.monthly.map((task,i)=>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li data-type="monthly" data-index="${i}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="task-${week}-monthly-${i}" class="task-checkbox mr-2" ${task.completed?'checked':''}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-${week}-monthly-${i}" class="${task.completed?'completed':''}">${task.text}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let weeklyTasksHtml = '';
Â  Â  Â  Â  Â  Â  if (weekData.tasks.weekly.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  weeklyTasksHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-card bg-[var(--card-bg)] p-6 rounded-xl shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-semibold">Weekly Tasks</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="edit-tasks-btn" data-week="${week}" data-type="weekly">Edit Tasks</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul id="weekly-tasks-${week}" class="text-[var(--text-color)]" draggable="true">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${weekData.tasks.weekly.map((task,i)=>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li data-type="weekly" data-index="${i}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="task-${week}-weekly-${i}" class="task-checkbox mr-2" ${task.completed?'checked':''}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-${week}-weekly-${i}" class="${task.completed?'completed':''}">${task.text}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  let dailyTasksHtml = '';
Â  Â  Â  Â  Â  Â  if (weekData.tasks.daily.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  dailyTasksHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-card bg-[var(--card-bg)] p-6 rounded-xl shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-header mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-xl font-semibold">Daily Tasks</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="edit-tasks-btn" data-week="${week}" data-type="daily">Edit Tasks</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <ul id="daily-tasks-${week}" class="text-[var(--text-color)]" draggable="true">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${weekData.tasks.daily.map((task,i)=>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <li data-type="daily" data-index="${i}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" id="task-${week}-daily-${i}" class="task-checkbox mr-2" ${task.completed?'checked':''}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="task-${week}-daily-${i}" class="${task.completed?'completed':''}">${task.text}</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `).join('')}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  contentContainer.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">${weekData.title}</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${monthlyTasksHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${weeklyTasksHtml}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dailyTasksHtml}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  updateMonthlyProgress();
Â  Â  Â  Â  };

Â  Â  Â  Â  const updateMonthlyProgress = () => {
Â  Â  Â  Â  Â  Â  const monthKey = getMonthKey(currentMonth);
Â  Â  Â  Â  Â  Â  const monthData = plannerData[monthKey];
Â  Â  Â  Â  Â  Â  if (!monthData) return;
Â  Â  Â  Â  Â  Â  const progress = calculateMonthlyProgress(monthData);
Â  Â  Â  Â  Â  Â  monthlyProgressFill.style.width = `${progress}%`;
Â  Â  Â  Â  Â  Â  monthlyProgressText.textContent = `${progress}% Complete`;
Â  Â  Â  Â  };

Â  Â  Â  Â  const renderDeadlines = () => {
Â  Â  Â  Â  Â  Â  deadlineList.innerHTML = '';
Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  today.setHours(0, 0, 0, 0); // Normalize today's date

Â  Â  Â  Â  Â  Â  const sortedDeadlines = deadlines.sort((a, b) => new Date(a.date) - new Date(b.date));

Â  Â  Â  Â  Â  Â  if (sortedDeadlines.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  deadlineList.innerHTML = '<p class="text-gray-500">No pending deadlines</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  sortedDeadlines.forEach(deadline => {
Â  Â  Â  Â  Â  Â  Â  Â  const deadlineDate = new Date(deadline.date);
Â  Â  Â  Â  Â  Â  Â  Â  const timeDiff = deadlineDate.getTime() - today.getTime();
Â  Â  Â  Â  Â  Â  Â  Â  const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

Â  Â  Â  Â  Â  Â  Â  Â  let colorClass = '';
Â  Â  Â  Â  Â  Â  Â  Â  if (daysDiff >= 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorClass = 'text-green-600';
Â  Â  Â  Â  Â  Â  Â  Â  } else if (daysDiff >= 1 && daysDiff < 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorClass = 'text-yellow-600';
Â  Â  Â  Â  Â  Â  Â  Â  } else if (daysDiff === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorClass = 'text-red-600 font-bold';
Â  Â  Â  Â  Â  Â  Â  Â  } else { // Past deadlines
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorClass = 'text-red-600 font-bold overdue';
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  Â  Â  Â  Â  li.className = `flex justify-between items-center p-3 rounded-md shadow-sm bg-white ${colorClass}`;
Â  Â  Â  Â  Â  Â  Â  Â  li.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="font-medium">${deadline.task}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-500">${deadline.client} - ${deadline.date}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="remove-deadline-btn text-red-500 hover:text-red-700 text-sm font-semibold mr-2">Remove</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  li.querySelector('.remove-deadline-btn').addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deadlines = deadlines.filter(d => d !== deadline);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.DEADLINES, deadlines);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â renderDeadlines();
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  deadlineList.appendChild(li);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  const renderClients = () => {
Â  Â  Â  Â  Â  Â  clientTableBody.innerHTML = '';
Â  Â  Â  Â  Â  Â  let filteredClients = clientData;

Â  Â  Â  Â  Â  Â  if (currentFilter === 'incomplete') {
Â  Â  Â  Â  Â  Â  Â  Â  filteredClients = clientData.filter(c => !c.complete);
Â  Â  Â  Â  Â  Â  } else if (currentFilter === 'complete') {
Â  Â  Â  Â  Â  Â  Â  Â  filteredClients = clientData.filter(c => c.complete);
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Apply sorting
Â  Â  Â  Â  Â  Â  const sortKey = Object.keys(sortDirection)[0];
Â  Â  Â  Â  Â  Â  if (sortKey) {
Â  Â  Â  Â  Â  Â  Â  Â  filteredClients.sort((a, b) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (a[sortKey] < b[sortKey]) return sortDirection[sortKey] === 'asc' ? -1 : 1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (a[sortKey] > b[sortKey]) return sortDirection[sortKey] === 'asc' ? 1 : -1;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 0;
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }


Â  Â  Â  Â  Â  Â  filteredClients.forEach((client, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const row = clientTableBody.insertRow();
Â  Â  Â  Â  Â  Â  Â  Â  row.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-4 py-3 whitespace-nowrap">${escapeHtml(client.company)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-4 py-3 whitespace-nowrap">${escapeHtml(client.services)}</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-4 py-3 whitespace-nowrap text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="checkbox" class="client-complete-checkbox" data-index="${index}" ${client.complete ? 'checked' : ''} class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="px-4 py-3 whitespace-nowrap text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="remove-client-btn text-red-500 hover:text-red-700 font-semibold text-sm mr-2" data-index="${index}">Remove</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  // Music genres render
Â  Â  Â  Â  const renderMusicGenres = () => {
Â  Â  Â  Â  Â  Â  genresListEl.innerHTML = '';
Â  Â  Â  Â  Â  Â  musicGenres.forEach((genre, index) => {
Â  Â  Â  Â  Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  Â  Â  Â  Â  div.className = 'genre-row';
Â  Â  Â  Â  Â  Â  Â  Â  div.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="${genre.url}" target="_blank" class="text-blue-600 hover:underline">${escapeHtml(genre.name)}</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="genre-actions">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="edit-genre-btn text-gray-500 hover:text-gray-700 text-sm" data-index="${index}">Edit</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="remove-genre-btn text-red-500 hover:text-red-700 text-sm" data-index="${index}">Delete</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  genresListEl.appendChild(div);
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â Event Listeners
Â  Â  Â  Â  Â  Â ======================= */
Â  Â  Â  Â  prevMonthBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  currentMonth.setMonth(currentMonth.getMonth() - 1);
Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.ACTIVE_MONTH, currentMonth.toISOString());
Â  Â  Â  Â  Â  Â  renderMonthNavigation();
Â  Â  Â  Â  Â  Â  renderWeekNavigation();
Â  Â  Â  Â  Â  Â  // Reset active week to 1 for the new month
Â  Â  Â  Â  Â  Â  activeWeek = 1;
Â  Â  Â  Â  Â  Â  renderWeekNavigation(); // Re-render to update active state
Â  Â  Â  Â  Â  Â  renderWeekContent(activeWeek);
Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.ACTIVE_WEEK, activeWeek);
Â  Â  Â  Â  });

Â  Â  Â  Â  nextMonthBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  currentMonth.setMonth(currentMonth.getMonth() + 1);
Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.ACTIVE_MONTH, currentMonth.toISOString());
Â  Â  Â  Â  Â  Â  renderMonthNavigation();
Â  Â  Â  Â  Â  Â  renderWeekNavigation();
Â  Â  Â  Â  Â  Â  // Reset active week to 1 for the new month
Â  Â  Â  Â  Â  Â  activeWeek = 1;
Â  Â  Â  Â  Â  Â  renderWeekNavigation(); // Re-render to update active state
Â  Â  Â  Â  Â  Â  renderWeekContent(activeWeek);
Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.ACTIVE_WEEK, activeWeek);
Â  Â  Â  Â  });

Â  Â  Â  Â  navigation.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('nav-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  const week = parseInt(e.target.dataset.week);
Â  Â  Â  Â  Â  Â  Â  Â  activeWeek = week;
Â  Â  Â  Â  Â  Â  Â  Â  renderWeekNavigation();
Â  Â  Â  Â  Â  Â  Â  Â  renderWeekContent(activeWeek);
Â  Â  Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.ACTIVE_WEEK, activeWeek);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Add deadline form submission
Â  Â  Â  Â  deadlineForm.addEventListener('submit', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const date = document.getElementById('deadline-date').value;
Â  Â  Â  Â  Â  Â  const task = document.getElementById('deadline-task').value.trim();
Â  Â  Â  Â  Â  Â  const client = document.getElementById('deadline-client').value.trim();

Â  Â  Â  Â  Â  Â  if (!date || !task || !client) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!date) document.getElementById('deadline-date-error').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  if (!task) document.getElementById('deadline-task-error').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  if (!client) document.getElementById('deadline-client-error').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  deadlines.push({ date, task, client });
Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.DEADLINES, deadlines);
Â  Â  Â  Â  Â  Â  deadlineForm.reset();
Â  Â  Â  Â  Â  Â  renderDeadlines();
Â  Â  Â  Â  });

Â  Â  Â  Â  // Add client modal events
Â  Â  Â  Â  addClientBtn.addEventListener('click', () => addClientModal.style.display = 'flex');
Â  Â  Â  Â  closeAddClientBtn.addEventListener('click', () => addClientModal.style.display = 'none');
Â  Â  Â  Â  cancelNewClientBtn.addEventListener('click', () => addClientModal.style.display = 'none');

Â  Â  Â  Â  newClientForm.addEventListener('submit', (e) => {
Â  Â  Â  Â  Â  Â  e.preventDefault();
Â  Â  Â  Â  Â  Â  const company = newClientCompanyInput.value.trim();
Â  Â  Â  Â  Â  Â  const services = newClientServicesInput.value.trim();

Â  Â  Â  Â  Â  Â  if (!company || !services) {
Â  Â  Â  Â  Â  Â  Â  Â  if (!company) document.getElementById('new-client-company-error').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  if (!services) document.getElementById('new-client-services-error').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  clientData.push({ company, services, complete: false });
Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.CLIENTS, clientData);
Â  Â  Â  Â  Â  Â  newClientForm.reset();
Â  Â  Â  Â  Â  Â  addClientModal.style.display = 'none';
Â  Â  Â  Â  Â  Â  renderClients();
Â  Â  Â  Â  });

Â  Â  Â  Â  // Undo client removal
Â  Â  Â  Â  undoClientBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  if (lastRemovedClient) {
Â  Â  Â  Â  Â  Â  Â  Â  clientData.push(lastRemovedClient);
Â  Â  Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.CLIENTS, clientData);
Â  Â  Â  Â  Â  Â  Â  Â  renderClients();
Â  Â  Â  Â  Â  Â  Â  Â  undoClientBtn.classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  lastRemovedClient = null;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Filter clients
Â  Â  Â  Â  filterClientsSelect.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  currentFilter = e.target.value;
Â  Â  Â  Â  Â  Â  renderClients();
Â  Â  Â  Â  });

Â  Â  Â  Â  // Client table events (completion, removal)
Â  Â  Â  Â  clientTableBody.addEventListener('change', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('client-complete-checkbox')) {
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(e.target.dataset.index);
Â  Â  Â  Â  Â  Â  Â  Â  clientData[index].complete = e.target.checked;
Â  Â  Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.CLIENTS, clientData);
Â  Â  Â  Â  Â  Â  Â  Â  renderClients(); // Re-render to apply filtering if active
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  clientTableBody.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('remove-client-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(e.target.dataset.index);
Â  Â  Â  Â  Â  Â  Â  Â  lastRemovedClient = clientData.splice(index, 1)[0];
Â  Â  Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.CLIENTS, clientData);
Â  Â  Â  Â  Â  Â  Â  Â  renderClients();
Â  Â  Â  Â  Â  Â  Â  Â  undoClientBtn.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  // Sorting
Â  Â  Â  Â  sortableHeaders.forEach(header => {
Â  Â  Â  Â  Â  Â  header.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  const sortKey = header.dataset.sortKey;
Â  Â  Â  Â  Â  Â  Â  Â  const currentSortDirection = sortDirection[sortKey] || 'desc';
Â  Â  Â  Â  Â  Â  Â  Â  sortDirection = {}; // Clear previous sort
Â  Â  Â  Â  Â  Â  Â  Â sortDirection[sortKey] = currentSortDirection === 'asc' ? 'desc' : 'asc';
Â  Â  Â  Â  Â  Â  Â  Â  renderClients();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

Â  Â  Â  Â  // Task editor button clicks
Â  Â  Â  Â  contentContainer.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('edit-tasks-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  const week = parseInt(e.target.dataset.week);
Â  Â  Â  Â  Â  Â  Â  Â  const type = e.target.dataset.type;
Â  Â  Â  Â  Â  Â  Â  Â  const monthKey = getMonthKey(currentMonth);
Â  Â  Â  Â  Â  Â  Â  Â  openTaskEditor(monthKey, week, type);
Â  Â  Â  Â  Â  Â  } else if (e.target.classList.contains('task-checkbox')) {
Â  Â  Â  Â  Â  Â  Â  Â  const li = e.target.closest('li');
Â  Â  Â  Â  Â  Â  Â  Â  const type = li.dataset.type;
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(li.dataset.index);
Â  Â  Â  Â  Â  Â  Â  Â  const monthKey = getMonthKey(currentMonth);
Â  Â  Â  Â  Â  Â  Â  Â  const week = parseInt(li.closest('.task-card').querySelector('.edit-tasks-btn').dataset.week);
Â  Â  Â  Â  Â  Â  Â  Â  plannerData[monthKey].weeks[week].tasks[type][index].completed = e.target.checked;
Â  Â  Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.PLANNER, plannerData);
Â  Â  Â  Â  Â  Â  Â  Â  // Update label class
Â  Â  Â  Â  Â  Â  Â  Â  li.querySelector('label').classList.toggle('completed', e.target.checked);
Â  Â  Â  Â  Â  Â  Â  Â  updateMonthlyProgress();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  taskEditClose.addEventListener('click', closeTaskEditor);
Â  Â  Â  Â  taskEditCancel.addEventListener('click', closeTaskEditor);
Â  Â  Â  Â  addNewTaskBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const text = newTaskText.value.trim();
Â  Â  Â  Â  Â  Â  const priority = newTaskPriority.value;
Â  Â  Â  Â  Â  Â  if (text) {
Â  Â  Â  Â  Â  Â  Â  Â  const monthKey = taskEditorContext.monthKey;
Â  Â  Â  Â  Â  Â  Â  Â  const week = taskEditorContext.week;
Â  Â  Â  Â  Â  Â  Â  Â  const type = taskEditorContext.type;
Â  Â  Â  Â  Â  Â  Â  Â  plannerData[monthKey].weeks[week].tasks[type].push({ text, priority, completed: false });
Â  Â  Â  Â  Â  Â  Â  Â  // Re-render the list in the modal to show the new task
Â  Â  Â  Â  Â  Â  Â  Â  const tasks = plannerData[monthKey].weeks[week].tasks[type];
Â  Â  Â  Â  Â  Â  Â  Â  taskEditList.innerHTML = tasks.map((t, idx)=>`
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="task-edit-item" data-index="${idx}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="rounded-md border-gray-300 p-2" value="${escapeHtml(t.text)}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select class="task-priority rounded-md p-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="low" ${t.priority==='low'?'selected':''}>Low</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="medium" ${t.priority==='medium'?'selected':''}>Medium</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="high" ${t.priority==='high'?'selected':''}>High</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="flex items-center gap-2"><input type="checkbox" class="task-completed" ${t.completed?'checked':''}> Done</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="ml-2 remove-task-btn text-red-500">Delete</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `).join('');
Â  Â  Â  Â  Â  Â  Â  Â  newTaskText.value = '';
Â  Â  Â  Â  Â  Â  Â  Â  newTaskText.focus();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  taskEditList.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('remove-task-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  const item = e.target.closest('.task-edit-item');
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(item.dataset.index);
Â  Â  Â  Â  Â  Â  Â  Â  const monthKey = taskEditorContext.monthKey;
Â  Â  Â  Â  Â  Â  Â  Â  const week = taskEditorContext.week;
Â  Â  Â  Â  Â  Â  Â  Â  const type = taskEditorContext.type;
Â  Â  Â  Â  Â  Â  Â  Â  plannerData[monthKey].weeks[week].tasks[type].splice(index, 1);
Â  Â  Â  Â  Â  Â  Â  Â  item.remove(); // Remove from the modal view
Â  Â  Â  Â  Â  Â  Â  Â  // Re-index other items to maintain correct dataset.index
Â  Â  Â  Â  Â  Â  Â  Â  taskEditList.querySelectorAll('.task-edit-item').forEach((el, idx) => el.dataset.index = idx);
Â  Â  Â  Â  Â  Â  } else if (e.target.classList.contains('task-completed')) {
Â  Â  Â  Â  Â  Â  Â  Â  const item = e.target.closest('.task-edit-item');
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(item.dataset.index);
Â  Â  Â  Â  Â  Â  Â  Â  const monthKey = taskEditorContext.monthKey;
Â  Â  Â  Â  Â  Â  Â  Â  const week = taskEditorContext.week;
Â  Â  Â  Â  Â  Â  Â  Â  const type = taskEditorContext.type;
Â  Â  Â  Â  Â  Â  Â  Â  plannerData[monthKey].weeks[week].tasks[type][index].completed = e.target.checked;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });


Â  Â  Â  Â  taskEditSave.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const monthKey = taskEditorContext.monthKey;
Â  Â  Â  Â  Â  Â  const week = taskEditorContext.week;
Â  Â  Â  Â  Â  Â  const type = taskEditorContext.type;

Â  Â  Â  Â  Â  Â  taskEditList.querySelectorAll('.task-edit-item').forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(item.dataset.index);
Â  Â  Â  Â  Â  Â  Â  Â  const text = item.querySelector('input[type="text"]').value.trim();
Â  Â  Â  Â  Â  Â  Â  Â  const priority = item.querySelector('select').value;
Â  Â  Â  Â  Â  Â  Â  Â  const completed = item.querySelector('.task-completed').checked;

Â  Â  Â  Â  Â  Â  Â  Â  plannerData[monthKey].weeks[week].tasks[type][index] = { text, priority, completed };
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.PLANNER, plannerData);
Â  Â  Â  Â  Â  Â  closeTaskEditor();
Â  Â  Â  Â  Â  Â  renderWeekContent(activeWeek); // Re-render the main content to reflect changes
Â  Â  Â  Â  });

Â  Â  Â  Â  // Music modal events
Â  Â  Â  Â  musicBtn.addEventListener('click', () => musicModal.style.display = 'flex');
Â  Â  Â  Â  musicClose.addEventListener('click', () => musicModal.style.display = 'none');
Â  Â  Â  Â  closeMusicBtn.addEventListener('click', () => musicModal.style.display = 'none');

Â  Â  Â  Â  genresListEl.addEventListener('click', (e) => {
Â  Â  Â  Â  Â  Â  if (e.target.classList.contains('remove-genre-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(e.target.dataset.index);
Â  Â  Â  Â  Â  Â  Â  Â  musicGenres.splice(index, 1);
Â  Â  Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.MUSIC, musicGenres);
Â  Â  Â  Â  Â  Â  Â  Â  renderMusicGenres();
Â  Â  Â  Â  Â  Â  } else if (e.target.classList.contains('edit-genre-btn')) {
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(e.target.dataset.index);
Â  Â  Â  Â  Â  Â  Â  Â  const genre = musicGenres[index];
Â  Â  Â  Â  Â  Â  Â  Â  newGenreName.value = genre.name;
Â  Â  Â  Â  Â  Â  Â  Â  newGenreLink.value = genre.url;
Â  Â  Â  Â  Â  Â  Â  Â  // Change add button to update button temporarily
Â  Â  Â  Â  Â  Â  Â  Â  addGenreBtn.textContent = 'Update Genre';
Â  Â  Â  Â  Â  Â  Â  Â  addGenreBtn.dataset.editingIndex = index; // Store index for updating
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  addGenreBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  const name = newGenreName.value.trim();
Â  Â  Â  Â  Â  Â  const url = newGenreLink.value.trim();

Â  Â  Â  Â  Â  Â  if (!name || !url) return;

Â  Â  Â  Â  Â  Â  if (addGenreBtn.textContent === 'Update Genre') {
Â  Â  Â  Â  Â  Â  Â  Â  const index = parseInt(addGenreBtn.dataset.editingIndex);
Â  Â  Â  Â  Â  Â  Â  Â  musicGenres[index] = { name, url };
Â  Â  Â  Â  Â  Â  Â  Â  addGenreBtn.textContent = 'Add Genre'; // Reset button text
Â  Â  Â  Â  Â  Â  Â  Â  delete addGenreBtn.dataset.editingIndex; // Remove editing index
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  musicGenres.push({ name, url });
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  saveData(STORAGE_KEYS.MUSIC, musicGenres);
Â  Â  Â  Â  Â  Â  newGenreName.value = '';
Â  Â  Â  Â  Â  Â  newGenreLink.value = '';
Â  Â  Â  Â  Â  Â  renderMusicGenres();
Â  Â  Â  Â  });


Â  Â  Â  Â  /* =======================
Â  Â  Â  Â  Â  Â Initialization
Â  Â  Â  Â  Â  Â ======================= */

Â  Â  Â  Â  // Display welcome popup
Â  Â  Â  Â  const displayWelcomePopup = () => {
Â  Â  Â  Â  Â  Â  const popupDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  popupDiv.id = 'welcome-popup';
Â  Â  Â  Â  Â  Â  popupDiv.style.cssText = `
Â  Â  Â  Â  Â  Â  Â  Â  position: fixed;
Â  Â  Â  Â  Â  Â  Â  Â  top: 0; left: 0; width: 100%; height: 100%;
Â  Â  Â  Â  Â  Â  Â  Â  background-color: rgba(0, 0, 0, 0.7);
Â  Â  Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  Â  Â  z-index: 1001;
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  const popupContent = document.createElement('div');
Â  Â  Â  Â  Â  Â  popupContent.style.cssText = `
Â  Â  Â  Â  Â  Â  Â  Â  background-color: white;
Â  Â  Â  Â  Â  Â  Â  Â  padding: 30px;
Â  Â  Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  const title = document.createElement('h2');
Â  Â  Â  Â  Â  Â  title.textContent = 'Welcome back, Great Conqueror.';
Â  Â  Â  Â  Â  Â  title.style.cssText = `
Â  Â  Â  Â  Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  popupContent.appendChild(title);

Â  Â  Â  Â  Â  Â  const deadlinesTitle = document.createElement('h3');
Â  Â  Â  Â  Â  Â  deadlinesTitle.textContent = 'Currently Active Deadlines:';
Â  Â  Â  Â  Â  Â  deadlinesTitle.style.cssText = `
Â  Â  Â  Â  Â  Â  Â  Â  font-size: 18px;
Â  Â  Â  Â  Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  Â  Â  Â  Â  Â  color: #555;
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  popupContent.appendChild(deadlinesTitle);

Â  Â  Â  Â  Â  Â  const deadlinesListDiv = document.createElement('div');
Â  Â  Â  Â  Â  Â  deadlinesListDiv.id = 'popup-deadline-list';
Â  Â  Â  Â  Â  Â  deadlinesListDiv.style.cssText = `
Â  Â  Â  Â  Â  Â  Â  Â  max-height: 200px;
Â  Â  Â  Â  Â  Â  Â  Â  overflow-y: auto;
Â  Â  Â  Â  Â  Â  Â  Â  text-align: left;
Â  Â  Â  Â  Â  Â  `;

Â  Â  Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  Â  Â  today.setHours(0, 0, 0, 0); // Normalize today's date

Â  Â  Â  Â  Â  Â  const sortedDeadlines = deadlines.sort((a, b) => new Date(a.date) - new Date(b.date));

Â  Â  Â  Â  Â  Â  if (sortedDeadlines.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  deadlinesListDiv.innerHTML = '<p class="text-gray-500">No pending deadlines</p>';
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  sortedDeadlines.forEach(deadline => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const deadlineDate = new Date(deadline.date);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const timeDiff = deadlineDate.getTime() - today.getTime();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let colorClass = '';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (daysDiff >= 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorClass = 'color-green';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else if (daysDiff >= 1 && daysDiff < 3) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorClass = 'color-yellow';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else { // Today or overdue
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colorClass = 'color-red';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const p = document.createElement('p');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p.style.cssText = `margin-bottom: 8px; padding: 5px; border-radius: 4px; ${getColorStyle(colorClass)}`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  p.innerHTML = `<strong>${escapeHtml(deadline.task)}</strong> - ${escapeHtml(deadline.client)} (${deadline.date})`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  deadlinesListDiv.appendChild(p);
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  popupContent.appendChild(deadlinesListDiv);

Â  Â  Â  Â  Â  Â  const closeButton = document.createElement('button');
Â  Â  Â  Â  Â  Â  closeButton.textContent = 'Got It!';
Â  Â  Â  Â  Â  Â  closeButton.style.cssText = `
Â  Â  Â  Â  Â  Â  Â  Â  background-color: #E42642;
Â  Â  Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  Â  Â  padding: 10px 20px;
Â  Â  Â  Â  Â  Â  Â  Â  border: none;
Â  Â  Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  Â  Â  margin-top: 20px;
Â  Â  Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  closeButton.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  popupDiv.remove();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  popupContent.appendChild(closeButton);

Â  Â  Â  Â  Â  Â  popupDiv.appendChild(popupContent);
Â  Â  Â  Â  Â  Â  document.body.appendChild(popupDiv);
Â  Â  Â  Â  };

Â  Â  Â  Â  // Function to get color styles based on deadline proximity
Â  Â  Â  Â  const getColorStyle = (colorClass) => {
Â  Â  Â  Â  Â  Â  switch(colorClass) {
Â  Â  Â  Â  Â  Â  Â  Â  case 'color-green':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'background-color: #d4edda; color: #155724;'; // Green background, dark green text
Â  Â  Â  Â  Â  Â  Â  Â  case 'color-yellow':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'background-color: #fff3cd; color: #856404;'; // Yellow background, dark yellow text
Â  Â  Â  Â  Â  Â  Â  Â  case 'color-red':
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'background-color: #f8d7da; color: #721c24; font-weight: bold;'; // Red background, dark red text
Â  Â  Â  Â  Â  Â  Â  Â  default:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return 'color: #333;'; // Default text color
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // Initial render calls
Â  Â  Â  Â  renderMonthNavigation();
Â  Â  Â  Â  renderWeekNavigation();
Â  Â  Â  Â  renderWeekContent(activeWeek);
Â  Â  Â  Â  renderDeadlines();
Â  Â  Â  Â  renderClients();
Â  Â  Â  Â  renderMusicGenres();

Â  Â  Â  Â  // Display the welcome popup after initial rendering
Â  Â  Â  Â  displayWelcomePopup();
Â  Â  });
Â  Â  </script>
</body>
</html>
